
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <style>
      .scrolly{
        height: 600px;
        overflow: auto;
      }
      .no-pad-no-margin{
        margin: 0;
        padding: 0 !important;
      }
      .hide{
        display: none;
      }
    </style>
  <body class= "jumbotron no-pad-no-margin">
    <nav class="navbar navbar-expand-lg fixed-top navbar-dark bg-dark">
        <a class="navbar-brand" href="#">Down2Hang</a>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link " data-toggle="modal" data-target="#aboutModal">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://github.com/down2hang/down2hang.github.io">Source</a>
            </li>
          </ul>
          <button class="btn btn-outline-primary my-2 my-sm-0" type="button" onclick="alertNotSupported()">Login</button>
        </div>
    </nav>
    <div class=" pt-5 mt-3 row">
      <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 scrolly border pt-2">
        <!-- Event Display Buttons -->
        <div id="eDisplayBtns" class="btn-block" role="group">
        </div>
        <!-- END Event Display Buttons -->

        <br>

        <!-- Button to trigger add event modal -->
        <button type="button" class="btn btn-outline-primary btn-lg btn-block" data-toggle="modal" data-target="#exampleModal">
          Add Event
        </button>
        <!-- END Button to trigger add event modal -->
        <br>
        <br>
      </div>
      <div id="rightCol" class="col-lg-6 col-md-6 col-sm-6 col-xs-6 scrolly border pt-2">
        <div id="eInfoSpace" class = "lead">
          <h1 class = "display-4 text-center">Hover Over An Event Or Make A New One On The Left To Get Started!</h1>
        </div>

        <br>

        <!-- Button to trigger join event modal -->
        <button id="joinEventBtn" type="button" class="btn btn-outline-primary btn-lg btn-block hide" data-toggle="modal" data-target="#joinEventModal">
          Join Event
        </button>
        <!-- END Button to trigger join event modal -->
      </div>
    </div>


    <!-- New Event Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title" id="exampleModalLabel">Start New Event!</h2>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="newEventInfo" onsubmit="go()" style="text-align: center; position: relative">

                <div class="input-group input-group-sm mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">First Name</span>
                  </div>
                  <input type="text" id="fname" class="form-control" name="firstname" placeholder="Your first name.." aria-label="Username" aria-describedby="basic-addon1" required>
                </div>

                <div class="input-group input-group-sm mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">Last Name</span>
                  </div>
                  <input type="text" aria-label="Username" class="form-control" aria-describedby="basic-addon1" id="lname" name="lastname" placeholder="Your last name.." required>
                </div>

                <div class="input-group input-group-sm mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">Email</span>
                  </div>
                  <input type="email" aria-label="Username" class="form-control" aria-describedby="basic-addon1" id="email" name="email" placeholder="stevejobs@gmail.com" required>
                </div>

                <div class="input-group input-group-sm mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">Minimum Participants</span>
                  </div>
                  <input type="number" aria-label="Username" class="form-control" aria-describedby="basic-addon1" id="minipart" name="minipart" placeholder='0' required>
                </div>

                <div class="input-group input-group-sm mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">Maximum Participants</span>
                  </div>
                  <input type="number" aria-label="Username" class="form-control" aria-describedby="basic-addon1" id="maxpart" name="maxpart" placeholder='100' required>
                </div>


                <div class="input-group input-group-sm mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">Event Title</span>
                  </div>
                  <input type="text" id="ename" name="maxpart" placeholder='John Doe'class="form-control" aria-label="Username" aria-describedby="basic-addon1" required>
                </div>

                <div class="input-group input-group-sm mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">Event Time</span>
                  </div>
                  <input type="time" aria-label="Username" class="form-control" aria-describedby="basic-addon1" id="etime" name="eventtime" placeholder="00:00:0000" required>
                </div>

                <div class="input-group input-group-sm mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">Event Location</span>
                  </div>
                  <input type="text" aria-label="Username" class="form-control" aria-describedby="basic-addon1" id="elocation" name="eventlocation" placeholder="Buckingham Palace" required>
                </div>

                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text">Event Description</span>
                  </div>
                  <textarea class="form-control" aria-label="With textarea"name="edesc" placeholder="Write something.." id= "edesc" style="height:200px" required></textarea>
                </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" type = "Submit" value="Submit" onclick="go()" class="btn btn-secondary" data-dismiss="modal">Create Event</button>
          </div>
        </div>
      </div>
    </div>
    <!-- END New Event Modal -->

    <!-- Join Event Modal -->
    <div class="modal fade" id="joinEventModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title" id="exampleModalLabel">Join An Event!</h2>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="joinEventForm" onsubmit="joinEvent()" style="text-align: center; position: relative">

              <div class="input-group input-group-sm mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">First Name</span>
                </div>
                  <input type="text" id="fnameadd" class="form-control" name="firstname" placeholder="Your first name.." aria-label="Username" aria-describedby="basic-addon1" required>
              </div>

              <div class="input-group input-group-sm mb-3">
                <div class="input-group-prepend">
                  <span class="input-group-text" id="basic-addon1">Last Name</span>
                </div>
                <input type="text" aria-label="Username" class="form-control" aria-describedby="basic-addon1" id="lnameadd" name="lastname" placeholder="Your last name.." required>
              </div>

              <div class="input-group input-group-sm mb-3">
                <div class="input-group-prepend">
                  <span class="input-group-text" id="basic-addon1">Email</span>
                </div>
                <input type="email" aria-label="Username" class="form-control" aria-describedby="basic-addon1" id="emailadd" name="email" placeholder="stevejobs@gmail.com" required>
              </div>

            </form>
          </div>
          <div class="modal-footer">
            <button id="joinEventSubmission" type="submit" value="Submit" onclick="joinEvent()" class="btn btn-secondary" data-dismiss="modal">Join</button>
          </div>
        </div>
      </div>
    </div>
    <!-- END Join Event Modal -->

    <!-- About Modal -->
    <div class="modal fade bd-example-modal-lg" id="aboutModal" tabindex="-1" role="dialog" aria-labelledby="aboutModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title" id="exampleModalLabel">About</h2>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <h3 class = "text-center">What does it do?</h3>
            <a>Down2Hang allows people to post and join events on our website and notifies people once the event has reached the specified minimum number of participants. No more showing up to frisbee practice and only finding 5 people there. Down2Hang keeps track of intended attendance and tells all participants when the minimum has been met, so people can confidently attend, knowing it's worth it. This is also a great way to find cool things to do and meet new people!</a>
            <br>
            <br>
            <h3 class = "text-center">Why is this cool?</h3>
            <a>We are a bunch of Amherst College ultimate frisbee players who also happen to love programming. We joined forces for the MLE New Year's Hackathon to solve a common problem amongst us. Getting enough people to come to frisbee practice can be a challenge. It's especially annoying when you need 14 players, for practice to be worthwhile. The pandemic made this even harder.<br><br>We hope that in the new year, after the pandemic, our website can be used to organize events for groups of people who want to (safely) coordinate fun activities. It's also a great way to make new friends in the new year.</a>

          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    <!-- END About Modal -->

    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-database.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<script>
function apicall(d) {
  fetch("https://hwzgmbb5mg.execute-api.us-east-1.amazonaws.com/test/check", {
    method:"POST",
    body: JSON.stringify({
  "Description": d.Description,
  "EventID": d.EventID,
  "Location": d.Location,
  "Participants": d.Participants,
  "Time": d.Time,
  "Title": d.Title,
  "max": parseInt(d.max),
  "min": parseInt(d.min)
})
  });
}</script>

    <script>
    function alertNotSupported(){
      alert("This function is not supported in this application of Down2Hang. Logins allow for users to see events specific to them or a select group of interest. Check back later for updates. Thanks for your understanding!")
    }
    let config = {
      apiKey: "AIzaSyC8iaO8kb95S5mnUa2WLSCrCO-2Vq7RWiE",
      authDomain: "amherst-hangout.firebaseapp.com",
      projectId: "amherst-hangout",
      databaseURL: "https://amherst-hangout-default-rtdb.firebaseio.com/",
    };

    function createHangout(eventID, eventTitle, eventTime, eventLocation, eventMin, eventMax, eventDescription) {
      let config = {
        apiKey: "AIzaSyC8iaO8kb95S5mnUa2WLSCrCO-2Vq7RWiE",
        authDomain: "amherst-hangout.firebaseapp.com",
        projectId: "amherst-hangout",
        databaseURL: "https://amherst-hangout-default-rtdb.firebaseio.com/",
      };
      if (!firebase.apps.length) {
        firebase.initializeApp(config);
      }

      this.database = firebase.database();
      let userRef = this.database.ref('Events/');

      let emptylist = [];


      userRef.child(eventID).set({
        'EventID': eventID,
          'Time': eventTime,
          'Location': eventLocation,
          'Title' : eventTitle,
          'Description': eventDescription,
          'min': eventMin,
          'max': eventMax,
          'Participants' : emptylist
      });

      console.log('this method finished.')

    }

    // function getEventInfo() {
    //   var eventsData;
    //   if (!firebase.apps.length) {
    //     firebase.initializeApp(config);
    //   }

    //   this.database = firebase.database();//not desired JSON data

    //   let userRef = this.database.ref('Events/');//not desired JSON data 

    //   userRef.on("value", 
    //   function(snapshot) {
    //     eventsData=snapshot.val();
    //   },
    //   function (errorObject) {
    //     console.log("The read failed: " + errorObject.code);
    //   }
    //   );
    //   return eventsData;
    // }

    function addParticipant(eventID,name,email) {
      let config = {
        apiKey: "AIzaSyC8iaO8kb95S5mnUa2WLSCrCO-2Vq7RWiE",
        authDomain: "amherst-hangout.firebaseapp.com",
        projectId: "amherst-hangout",
        databaseURL: "https://amherst-hangout-default-rtdb.firebaseio.com/",
      };
      if (!firebase.apps.length) {
        firebase.initializeApp(config);
      }

      this.database = firebase.database();


      let userRef = this.database.ref('Events/' + eventID);

      // emptylist = [];
      // //Create participants list
      // userRef.child('Participants').set(emptylist)

      // Update (push participant to list)
      userRef.child('Participants').push({'Name': name, 'Email':email})

      userRef.on("value", function(snapshot) {



        var requestData = snapshot.val(); 

        apicall(requestData);
        console.log(requestData.Participants);


      }



      , function (errorObject) {
      console.log("The read failed: " + errorObject.code);
      });
        var requestData = {

        }
  

    }


    function go(){
      //event.preventDefault();
      var fname=document.getElementById("fname").value.toString();
      var lname=document.getElementById("lname").value.toString();
      var email=document.getElementById("email").value.toString();
      var minipart=document.getElementById("minipart").value.toString();
      var maxpart=document.getElementById("maxpart").value.toString();
      var ename=document.getElementById("ename").value.toString();
      var etime=document.getElementById("etime").value.toString();
      var elocation=document.getElementById("elocation").value.toString();
      var edesc=document.getElementById("edesc").value.toString();
      document.getElementById("newEventInfo").reset();
      var numEvents = Math.round(Math.random()*4206969);//EDIT THIS SHIT LATER!!
      createHangout(numEvents, ename, etime, elocation, minipart, maxpart, edesc);
      console.log(numEvents);
      addParticipant(numEvents,fname+' '+lname,email);
      alert("Your event has been submitted! You will receive an email when enough signups have occured.");
    }


    function joinEvent(){
      var eid=document.getElementById("joinEventSubmission").name;
      var fname=document.getElementById("fnameadd").value.toString();
      var lname=document.getElementById("lnameadd").value.toString();
      var email=document.getElementById("emailadd").value.toString();
      addParticipant(eid,fname+' '+lname,email);
      alert("You've been added to the event! You will receive an email when enough signups have occured.");
    }


    var allData;
    function displayEvents(){
      var eventsData;
      if (!firebase.apps.length) {
        firebase.initializeApp(config);
      }

      this.database = firebase.database();//not desired JSON data

      let userRef = this.database.ref('Events/');//not desired JSON data 

      userRef.on("value", 
        function(snapshot) {
          document.getElementById("eDisplayBtns").innerHTML = "";
          eventsData=snapshot.val();
          dataMess=eventsData;
          for (event in eventsData){
            var eventButton = document.createElement('BUTTON');
            eventButton.innerHTML = eventsData[event].Title;
            eventButton.className = "btn btn-primary btn-lg btn-block rounded-lg border";
            eventButton.type = "button";
            eventButton.id = eventsData[event].EventID;
            eventButton.onmouseover = function showEvent(){
              var desc = document.createElement('h5');
              desc.innerHTML = "Description: " + dataMess[this.id].Description;
              var eTitle = document.createElement('h1');
              eTitle.innerHTML = dataMess[this.id].Title;
              eTitle.className = "display-4 text-center";
              var eTime = document.createElement('h5');
              eTime.innerHTML = "Time(military standard): @" + dataMess[this.id].Time;
              var eLocation = document.createElement('h5');
              eLocation.innerHTML = "Location: " + dataMess[this.id].Location;
              var numPpl = document.createElement('h5');
              numPpl.innerHTML = "Number of Participants: " + Object.keys(dataMess[this.id].Participants).length;
              var hr = document.createElement("hr");
              hr.className = "my-4";
              var eInfoSpace = document.getElementById("eInfoSpace");
              eInfoSpace.innerHTML= "";
              eInfoSpace.appendChild(eTitle);
              eInfoSpace.appendChild(hr);
              eInfoSpace.appendChild(desc);
              eInfoSpace.appendChild(eLocation);
              eInfoSpace.appendChild(eTime);
              eInfoSpace.appendChild(numPpl);
              //make join event btn visible
              var joinEBtn = document.getElementById("joinEventBtn");
              joinEBtn.innerHTML = "Join "+ eTitle.innerHTML+"!";
              joinEBtn.style.display = "initial";
              //store active event id in submit button's name
              document.getElementById("joinEventSubmission").name = this.id;
            }
            document.getElementById("eDisplayBtns").appendChild(eventButton);
          }
        },
        function (errorObject) {
          console.log("The read failed: " + errorObject.code);
        }
      );
    }

    function displayHomePage(){
      displayEvents();
    }

    displayHomePage(); //Home page's content depends on data that is loaded through scripts, so better to show it after loading
  </script>
  </body>
</html>
